ChineseTextAnalyzer=function(){var e=/[0-9]|[a-z]|[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d]/i,r=function(e,r,n){return 19e5-1e3*(e+n)-(r+n)},n=function(e,r){return[((e=19e5-e)-e%1e3)/1e3-r,e%1e3-r]};function u(e,r,u){if(null===r){for(var s=[],a=0;a<=e;a++)s.push(a+u);return[s]}var t={};Object.keys(r).forEach(function(e){var r=n(e,u);void 0!==t[r[0]]?t[r[0]].push(r[1]):t[r[0]]=[r[1]]});for(var h=[],o=0;o<=e+1;o++)h[o]=null;var f=e+1,l=function(r,n){var s=n.length+1;if(!(s>f)){n.push(r+u);var a=t[r];if(a)for(var o=0;o<a.length;o++)l(a[o],[].concat(n));else r===e&&(s<f&&(f=s),null===h[s]?h[s]=[n]:h[s].push(n))}};l(0,[]);for(var i=2;i<h.length;i++)if(null!==h[i])return h[i]}return{analyzePhrasePhoneticsOfWords:function(e,r,n,u=8,s,a){var t=[],h=-1,o=[];if(e.forEach(function(e,u){o[u]=null;var f=e.error,l=e.words,i=e.phrasesData;if(f)o[u]={words:l,error:f};else{var c=function(e,r){o[u]={words:l,phrasePhonetics:e},console.log("Task "+r+" ended"),h<t.length-1&&t[++h](h),o.every(function(e){return null!==e})&&n(o)};t.push(function(e){if(console.log("Task "+e+" started"),s){var n=s(),u=n[0],t=n[1];u.postMessage(JSON.stringify({workerTask:"phrasingParse",words:l,phrasesData:i,wordsJoiner:r})),u.onmessage=function(r){a&&a(t);var n=r.data;c(n,e)}}else{var h=ChineseTextAnalyzer.phrasingParse(l,i,r);c(h,e)}})}}),t.length>0)for(var f=0;f<u&&f<=t.length-1;f++)t[h=f](h);else n(o)},phrasingParse:function(e,s,a){var t=[];return function(e,r){for(var s=[],a=0;a<e;a++)s[a]=!1;var t=[];Object.keys(r).forEach(function(e){var r=n(e,0),u=r[0],a=r[1],h=r[1]-r[0];t.indexOf(h)<0&&t.push(h);for(var o=u;o<a;o++)s[o]=!0}),t.sort(function(e,r){return e-r});for(var h=[],o=[],f=[],l=!1,i=0;i<e;i++)l?s[i]?(h[h.length-1]++,l=!0):(h.push(1),o.push(i),l=!1):s[i]?(h.push(1),o.push(i),f.push(h.length-1),l=!0):(0===h.length?(h.push(1),o.push(i)):h[h.length-1]++,l=!1);for(var c=[],d=-1,p=0;p<h.length;p++)f.indexOf(p)>=0?c[p]=u(h[p],r,o[p]):c[p]=u(h[p],null,o[p]),(-1===d||c[p].length<d)&&(d=c[p].length);for(var v=[],g=0;g<d;g++){for(var A=[c[0][g][0]],F=0;F<c.length;F++)for(var y=1;y<c[F][g].length;y++)A.push(c[F][g][y]);v.push(A)}return v}(e.length,s).forEach(function(n){for(var u=[],h=[],o=[],f=0;f<n.length-1;f++){for(var l=n[f],i=n[f+1],c=r(l,i,0),d="",p=l;p<i;p++)p>l&&(d+=a),d+=e[p];u.push(d);var v=s[c];v?(h.push(v[0]),o.push(v[1])):(h.push(null),o.push(null))}t.push([u,h,o])}),t},parseChineseText:function(r){var n=r.split(""),u=[],s=[];let a=[],t=null;return n.forEach(function(r){e.test(r)?(!0===t||null===t?a.push(r):(u.push(a),t&&s.push(u.length-1),a=[r]),t=!0):(!1===t||null===t?a.push(r):(u.push(a),t&&s.push(u.length-1),a=[r]),t=!1)}),u.push(a),t&&s.push(u.length-1),[u,s]}}}(),self.onmessage=function(e){try{var r=JSON.parse(e.data)}catch(e){return}switch(r.workerTask){case"analyzePhrasePhoneticsOfWords":ChineseTextAnalyzer.analyzePhrasePhoneticsOfWords(r.executedClausesInfo,r.wordsJoiner,function(e){postMessage(e)});break;case"phrasingParse":var n=ChineseTextAnalyzer.phrasingParse(r.words,r.phrasesData,r.wordsJoiner);postMessage(n)}};