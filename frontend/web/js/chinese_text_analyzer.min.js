ChineseTextAnalyzer=function(){var e=/[0-9]|[a-z]|[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d]/i,r=function(e,r,n){return 19e5-1e3*(e+n)-(r+n)},n=function(e,r){return[((e=19e5-e)-e%1e3)/1e3-r,e%1e3-r]};function u(e,r,u){if(null===r){for(var s=[],a=0;a<=e;a++)s.push(a+u);return[s]}var t={};Object.keys(r).forEach(function(e){var r=n(e,u);void 0!==t[r[0]]?t[r[0]].push(r[1]):t[r[0]]=[r[1]]});for(var o=[],h=0;h<=e+1;h++)o[h]=null;var f=e+1,l=function(r,n){var s=n.length+1;if(!(s>f)){n.push(r+u);var a=t[r];if(a)for(var h=0;h<a.length;h++)l(a[h],[].concat(n));else r===e&&(s<f&&(f=s),null===o[s]?o[s]=[n]:o[s].push(n))}};l(0,[]);for(var i=2;i<o.length;i++)if(null!==o[i])return o[i]}return{analyzePhrasePhoneticsOfWords:function(e,r,n,u=8,s,a){var t=[],o=-1,h=[];if(e.forEach(function(e,u){h[u]=null;var f=e.error,l=e.words,i=e.phrasesData;if(f)h[u]={words:l,error:f};else{var c=function(e,r){h[u]={words:l,phrasePhonetics:e},console.log("Task "+r+" ended"),o<t.length-1&&t[++o](o),h.every(function(e){return null!==e})&&n(h)};t.push(function(e){if(console.log("Task "+e+" started"),s){var n=s(),u=n[0],t=n[1];u.postMessage(JSON.stringify({workerTask:"phrasingParse",words:l,phrasesData:i,wordsJoiner:r})),u.onmessage=function(r){a&&a(t);var n=r.data;c(n,e)}}else setTimeout(function(){var n=ChineseTextAnalyzer.phrasingParse(l,i,r);c(n,e)},0)})}}),t.length>0)for(var f=0;f<u&&f<=t.length-1;f++)t[o=f](o);else n(h)},phrasingParse:function(e,s,a){var t=[];return function(e,r){for(var s=[],a=0;a<e;a++)s[a]=!1;var t=[];Object.keys(r).forEach(function(e){var r=n(e,0),u=r[0],a=r[1],o=r[1]-r[0];t.indexOf(o)<0&&t.push(o);for(var h=u;h<a;h++)s[h]=!0}),t.sort(function(e,r){return e-r});for(var o=[],h=[],f=[],l=!1,i=0;i<e;i++)l?s[i]?(o[o.length-1]++,l=!0):(o.push(1),h.push(i),l=!1):s[i]?(o.push(1),h.push(i),f.push(o.length-1),l=!0):(0===o.length?(o.push(1),h.push(i)):o[o.length-1]++,l=!1);for(var c=[],d=-1,p=0;p<o.length;p++)f.indexOf(p)>=0?c[p]=u(o[p],r,h[p]):c[p]=u(o[p],null,h[p]),(-1===d||c[p].length<d)&&(d=c[p].length);for(var v=[],g=0;g<d;g++){for(var A=[c[0][g][0]],F=0;F<c.length;F++)for(var y=1;y<c[F][g].length;y++)A.push(c[F][g][y]);v.push(A)}return v}(e.length,s).forEach(function(n){for(var u=[],o=[],h=[],f=0;f<n.length-1;f++){for(var l=n[f],i=n[f+1],c=r(l,i,0),d="",p=l;p<i;p++)p>l&&(d+=a),d+=e[p];u.push(d);var v=s[c];v?(o.push(v[0]),h.push(v[1])):(o.push(null),h.push(null))}t.push([u,o,h])}),t},parseChineseText:function(r){var n=r.split(""),u=[],s=[];let a=[],t=null;return n.forEach(function(r){e.test(r)?(!0===t||null===t?a.push(r):(u.push(a),t&&s.push(u.length-1),a=[r]),t=!0):(!1===t||null===t?a.push(r):(u.push(a),t&&s.push(u.length-1),a=[r]),t=!1)}),u.push(a),t&&s.push(u.length-1),[u,s]}}}(),self.onmessage=function(e){try{var r=JSON.parse(e.data)}catch(e){return}switch(r.workerTask){case"analyzePhrasePhoneticsOfWords":ChineseTextAnalyzer.analyzePhrasePhoneticsOfWords(r.executedClausesInfo,r.wordsJoiner,function(e){postMessage(e)});break;case"phrasingParse":var n=ChineseTextAnalyzer.phrasingParse(r.words,r.phrasesData,r.wordsJoiner);postMessage(n)}};